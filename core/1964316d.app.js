"use strict";angular.module("azkvizApp",["ngAnimate","ngCookies","ngResource","ngSanitize","ui.router","angularFileUpload"]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/"),c.html5Mode(!0)}]),angular.module("azkvizApp").controller("MainCtrl",["$scope","$state","Document","game",function(a,b,c,d){a.onFileSelect=function(e){var f=new FileReader;f.onload=function(e){c.parseXLSX(e.target.result),d.newGame(),d.curTeam=1,a.$apply(function(){b.go("teamsel")})},f.readAsBinaryString(e[0])}}]),angular.module("azkvizApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"core/main/main.html",controller:"MainCtrl"})}]),angular.module("azkvizApp").controller("PyramidCtrl",["$scope","$state","game","utils",function(a,b,c,d){d.warnOnExit(a),a.hexClicked=function(d){c.isHexAvailable(d)&&(c.curHex=d,b.go("question"),a.$apply())},a.getCurTeam=function(){return c.curTeam},a.pyramid=c.pyramid,a.btnDo=function(){c.pyramid[5]=2,console.log(a.pyramid)},a.goBack=function(){b.go("main")}}]),angular.module("azkvizApp").config(["$stateProvider",function(a){a.state("pyramid",{templateUrl:"core/pyramid/pyramid.html",controller:"PyramidCtrl"})}]),angular.module("azkvizApp").directive("hexTimer",function(){return{templateUrl:"core/question/hexTimer/hexTimer.html",restrict:"E",scope:{seconds:"@",active:"@",onFinish:"&"},link:function(a,b,c){a.seconds=a.seconds?a.seconds:10;var d=b[0].getElementsByClassName("pie")[0],e=0,f=Math.PI,g=30,h=360*g/(1e3*a.seconds);c.$observe("active",function(a){function b(a){var b;if(360!=a)var c=a*f/180,e=29.44*Math.sin(c),g=-29.44*Math.cos(c),h=a>180?1:0,b="M 0 0 v -29.44 A 29.44 29.44 1 "+h+" 1 "+e+" "+g;else b="M 0 -29.44 a 29.44 29.44 0 1 1 0 58.88 a 29.44 29.44 0 1 1 0 -58.88";d.setAttribute("d",b)}"true"!==a&&(e=0);var g=setInterval(function(){e+=h,"true"!==c.active?(clearInterval(g),b(0)):e>360?(clearInterval(g),b(360)):b(e)},30)})},controller:["$scope","$timeout","$interval",function(a,b,c){var d,e;a.$watch("active",function(f){return"true"!=f?(c.cancel(d),b.cancel(e),void(a.secsLeft=a.seconds)):(d=c(function(){a.secsLeft-=1},1e3,a.seconds),void(e=b(a.onFinish,1e3*a.seconds)))})}]}}),angular.module("azkvizApp").controller("QuestionCtrl",["$scope","$state","game","utils",function(a,b,c,d){d.warnOnExit(a),a.isAnswered=!1,a.game=c,a.question=c.getRandomQuestion(),a.question.shuffleAnswers();var e=c.hexState.BLACK;a.myEnd=function(){b.go("pyramid"),a.$apply(),c.pyramid[c.curHex]=e,c.toggleTeam()},a.selectedAnswer=-1,a.correctAnsIndex=a.question.answers.indexOf(a.question.$correctAnswer),a.selectAnswer=function(b){a.isAnswered||(a.question.answers[b]===a.question.$correctAnswer&&(e=c.curTeam),a.selectedAnswer=b,a.isAnswered=!0)},a.oneAnsVisible=!1,a.oneAnsState=-1,a.setOneAnsState=function(b){a.oneAnsState=b,e=1===b?c.curTeam:c.hexState.BLACK,-1!==b&&(a.isAnswered=!0)}}]),angular.module("azkvizApp").config(["$stateProvider",function(a){a.state("question",{templateUrl:"core/question/question.html",controller:"QuestionCtrl"})}]),angular.module("azkvizApp").controller("TeamselCtrl",["$scope","$state","game","utils",function(a,b,c,d){var e=function(){b.go("pyramid")};a.selectT1=function(){c.curTeam=1,e()},a.selectT2=function(){c.curTeam=2,e()},a.selectRandom=function(){c.curTeam=d.randInt(2)+1,e()}}]),angular.module("azkvizApp").config(["$stateProvider",function(a){a.state("teamsel",{templateUrl:"core/teamsel/teamsel.html",controller:"TeamselCtrl"})}]),angular.module("azkvizApp").directive("azHex",function(){return{link:function(a,b,c){b.bind("click",function(){a.hexClicked(parseInt(c.azHex,10))}),a.$watch(function(){return a.pyramid[parseInt(c.azHex,10)]},function(a){switch(a){case 1:b.removeClass("hex3"),b.addClass("hex1"),b.removeClass("hex-clickable");break;case 2:b.removeClass("hex3"),b.addClass("hex2"),b.removeClass("hex-clickable");break;case 3:b.addClass("hex3")}})}}}),angular.module("azkvizApp").factory("Document",["Question",function(a){function b(){}var c=[];return b.clear=function(){c=[]},b.getQuestionsArray=function(){return jQuery.extend(!0,[],c)},b.parseJson=function(b){angular.forEach(b,function(b){this.push(a.fromJson(b))},c)},b.parseXLSX=function(d){var e=function(a,b){var c=(a+1).toString(),d=String.fromCharCode("A".charCodeAt(0)+b);return d+c};b.clear();for(var f,g=XLSX.read(d,{type:"binary"}),h=g.Sheets[g.SheetNames[0]],i=0,j=0;void 0!==h[e(j,i)];){for(;void 0!==(f=h[e(j,i)]);)0===i?c[j]=new a(f.v):1===i?(c[j].answers.push(f.v),c[j].$correctAnswer=f.v):c[j].answers.push(f.v),i++;i=0,j++}},b.isEmpty=function(){return 0===c.length()},b}]),angular.module("azkvizApp").factory("game",["Document","utils",function(a,b){function c(){}c.curTeam=-1,c.curHex=-1,c.pyramid=[],c.hexState=Object.freeze({DEFAULT:0,TEAM0:1,TEAM1:2,BLACK:3});var d=[];return c.newGame=function(){d=a.getQuestionsArray();for(var b=0;28>b;b++)c.pyramid[b]=c.hexState.DEFAULT},c.isHexAvailable=function(a){return c.pyramid[a]!==c.hexState.TEAM0&&c.pyramid[a]!==c.hexState.TEAM1},c.getRandomQuestion=function(){0===d.length&&(d=a.getQuestionsArray());var c=b.randInt(d.length),e=d[c];return d.splice(c,1),e},c.toggleTeam=function(){c.curTeam=c.curTeam===c.hexState.TEAM0?c.hexState.TEAM1:c.hexState.TEAM0},c}]),angular.module("azkvizApp").factory("Question",["utils",function(a){function b(a){this.text=a||"",this.answers=[],this.$correctAnswer=null}return b.prototype={shuffleAnswers:function(){a.shuffle(this.answers)},setAnswers:function(a){this.answers=a,void 0!==this.answers[0]&&(this.$correctAnswer=this.answers[0])},hasOneAnswer:function(){return 1===this.answers.length}},b.fromJson=function(a){var c=new b(a.text);return c.setAnswers(a.answers),c},b}]),angular.module("azkvizApp").factory("utils",["$window",function(a){return{shuffle:function(a){for(var b,c,d=a.length;d;b=Math.floor(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);return a},randInt:function(a){return Math.floor(Math.random()*a)},warnOnExit:function(b){a.onbeforeunload=function(){return"Opravdu si přejete opustit AZKvíz? Rozehraná hra bude ztracena!"},b.$on("$destroy",function(){a.onbeforeunload=void 0})}}}]),angular.module("azkvizApp").run(["$templateCache",function(a){a.put("core/main/main.html",'<div class=header-box><h1><span style="font-weight: 300">AZ</span><span style="font-weight: 900">Kvíz</span></h1><div class=btn-open ng-file-select ng-model=files ng-file-change=onFileSelect(files) accept=*.xlsx><span class="glyphicon glyphicon-folder-open"></span></div></div><div class=footer><p>Copyright © 2014 Jan Hrdina</p></div>'),a.put("core/pyramid/pyramid.html",'<div class=nav-back ng-click=goBack()><span class="glyphicon glyphicon-arrow-left"></span></div><div class="team-indicator team{{getCurTeam()}}"></div><div class=pyramid-box><div class=pyramid-line><div class="hex hex-clickable" az-hex=1><span>1</span></div></div><div class=pyramid-line><div class="hex hex-clickable" az-hex=2><span>2</span></div><div class="hex hex-clickable" az-hex=3><span>3</span></div></div><div class=pyramid-line><div class="hex hex-clickable" az-hex=4><span>4</span></div><div class="hex hex-clickable" az-hex=5><span>5</span></div><div class="hex hex-clickable" az-hex=6><span>6</span></div></div><div class=pyramid-line><div class="hex hex-clickable" az-hex=7><span>7</span></div><div class="hex hex-clickable" az-hex=8><span>8</span></div><div class="hex hex-clickable" az-hex=9><span>9</span></div><div class="hex hex-clickable" az-hex=10><span>10</span></div></div><div class=pyramid-line><div class="hex hex-clickable" az-hex=11><span>11</span></div><div class="hex hex-clickable" az-hex=12><span>12</span></div><div class="hex hex-clickable" az-hex=13><span>13</span></div><div class="hex hex-clickable" az-hex=14><span>14</span></div><div class="hex hex-clickable" az-hex=15><span>15</span></div></div><div class=pyramid-line><div class="hex hex-clickable" az-hex=16><span>16</span></div><div class="hex hex-clickable" az-hex=17><span>17</span></div><div class="hex hex-clickable" az-hex=18><span>18</span></div><div class="hex hex-clickable" az-hex=19><span>19</span></div><div class="hex hex-clickable" az-hex=20><span>20</span></div><div class="hex hex-clickable" az-hex=21><span>21</span></div></div><div class=pyramid-line><div class="hex hex-clickable" az-hex=22><span>22</span></div><div class="hex hex-clickable" az-hex=23><span>23</span></div><div class="hex hex-clickable" az-hex=24><span>24</span></div><div class="hex hex-clickable" az-hex=25><span>25</span></div><div class="hex hex-clickable" az-hex=26><span>26</span></div><div class="hex hex-clickable" az-hex=27><span>27</span></div><div class="hex hex-clickable" az-hex=28><span>28</span></div></div></div>'),a.put("core/question/hexTimer/hexTimer.html",'<div class=timer-container><svg xmlns=http://www.w3.org/2000/svg height=59 width=51><path fill=#e6e6e6 d="M50.998 44.605l-25.504 14.75L-.01 44.63V15.183L25.494.432l25.504 14.723z"><path fill=#ff8427 class=pie transform="translate(25.5,29.44)"><path fill=#fff d="M0 .118v14.72L25.5.117H0zm25.5 0L51 14.838V.117H25.5zM0 44.238v14.72h25.5L0 44.257zm25.5 14.72H51v-14.72l-25.5 14.72zM45.995 42.042l-20.508 11.86L4.98 42.063v-23.68l20.507-11.86 20.508 11.84z"></svg><p class=timer-label>{{secsLeft}}</p></div>'),a.put("core/question/question.html",'<div class="row question-container"><div class="col-xs-2 qst-nav-col"><div class="hex hex-clickable hex-qst-back" ng-click=myEnd() ng-show=isAnswered><span class="glyphicon glyphicon-arrow-left"></span></div><div class="hex hex-qst-active" ng-class="{hex1: game.curTeam === 1, hex2: game.curTeam === 2}"><span>{{game.curHex}}</span></div></div><div class=col-xs-8><p class=question ng-class="{clickable: question.hasOneAnswer() &amp;&amp; !oneAnsVisible}" ng-click="oneAnsVisible = true">{{question.text}}</p><!-- Multiple Choices --><ol class=my-ol type=A ng-if=!question.hasOneAnswer()><li class=answer ng-class="{\n          \'answer-correct\': isAnswered &amp;&amp; $index == correctAnsIndex,\n          \'answer-wrong\': isAnswered &amp;&amp; $index != correctAnsIndex &amp;&amp; selectedAnswer == $index,\n          \'clickable\': !isAnswered}" ng-click=selectAnswer($index) ng-repeat="answer in question.answers">{{answer}}</li></ol><!-- One Answer Mode --><div ng-if=question.hasOneAnswer() ng-show=oneAnsVisible><div class=correct-wrong-btns><div class="hex hex-clickable hex-qst-wrong" ng-class="{\'hex-inactive\': oneAnsState === 1}" ng-click=setOneAnsState(0)><span class="glyphicon glyphicon-remove"></span></div><div class="hex hex-clickable hex-qst-correct" ng-class="{\'hex-inactive\': oneAnsState === 0}" ng-click=setOneAnsState(1)><span class="glyphicon glyphicon-ok"></span></div></div><div class="answer one-answer">{{question.$correctAnswer}}</div></div></div></div>'),a.put("core/teamsel/teamsel.html",'<div class=who-box><div class=who-text>Kdo začne?</div><div class="hex hex1 hex-clickable" ng-click=selectT1()><span>&nbsp;</span></div><div class="hex hex3 hex-clickable" ng-click=selectRandom()><span>?</span></div><div class="hex hex2 hex-clickable" ng-click=selectT2()><span>&nbsp;</span></div></div>')}]);